Детали можно найти на странице документации [Concepts](https://kserve.github.io/website/latest/modelserving/control_plane/).
### Control Plane

KServe Control Plane (панель управления). Чтобы включить автомасштабирование создает бессерверное развертывание Knative для predictor, transformer, explainer. В случае режима сырого развертывания панель управления создает Kubernetes Deployment, Service, Ingress и HPA.

#### Control Plane Components

- KServe Controller:  отвечает за создание Service, Ingress Resources, контейнеров Model Server и Model Agent для логгирования запросов/ответов, пакетирования и пр.
- Ingress Gateway: шлюз (gateway) для маршрутизации внешних и внутренних запросов.

В бессерверном режиме:
- Knative Serving Controller: отвечает за управление версиями сервисов, создание ресурсов сетевой маршрутизации и пр.
- Knative Activator: возвращает убитые поды (scaled-to-zero pods) и пересылает запросы (forwards requests).
- Knative Autoscaler (KPA): отслеживает поток трафика и масштабирует реплики в соответствии с метриками.

### Data Plane

Архитектура панели данных сервиса логического вывода состоит из статического графа компонентов, которые координируют запросы для одной модели.

Протокол Data Plane от KServe предоставляет API логического вывода, который не зависит от какой-то конкретной платформы ML/DL и сервера моделей

Протокол логического вывода KServe одобрен NVIDIA Triton Inference Server, TensorFlow Serving и TorchServe.

Концепты:
- Component: каждая концевая точка состоит из нескольких компонентов -- predictor, explainer и transformer. Обязательным компонентом является только predictor.
- Predictor: это рабочая лошадка InferenceService. Это просто модель и сервер моделей, который делает ее доступной в концевой точке сети.
- Explainer: expainer делает доступной вспомогательную альтернативную панель данных, которая предоставляет объяснения модели в дополнение к прогнозам.
- Transformer: transfomer делает доступным для пользователей шаг пре- и постообработки перед рабочими процессами прогноза и объяснения.

#### Data Plane V1 & V2

KServe поддерживает и протокол V1, и протокол V2. Протокол V1 предлагает стандартный рабочий процесс взаимодействия по HTTP/REST. Протокол V2 устраняет некоторые проблемы, обнаруженных для протокола V1, включая проблемы производительности, и расширяет V1 поддержкой API удаленного вызова процедур (gRPC). Для справки, сервер логического вывода MLServer Seldon поддерживает только протокол V2
![[serving_runtime_support_matrix.PNG]]

Протокол V2 расширяет возможности протокола V1 за счет добавления поддержки gRPC APIs.

Главные изменения V2:
- на текущий момент протокол V2 не поддерживает концевую точку Explain
- добавляет концевые точки Готовность (Readiness) / Живучесть (Liveness) / Metadata
- пути концевых точек содержат `/` вместо `:`
- концевая точка `:predict` переименована в `/infer`
- позволяет опционально указывать версии модели в пути

![[v1_api.png]]

![[v2_api.png]]