Детали можно найти на странице документации [Canary Rollout Strategy](https://kserve.github.io/website/latest/modelserving/v1beta1/rollout/canary/).

KServe поддерживает _канареечное развертывание_ для сервисов логического вывода (inference services). Канареечное развертывание позволяет новой версии InferenceService получить заданный процент трафика. KServe поддерживает настраиваемую стратегию канареечного развертывания в несколько шагов. Стратегия развертывания также может быть реализована с возможностью отката к предыдущей версии в случае, если шаг развертывания завершился ошибкой.

KServe автоматически отслеживает последнюю "хорошую" версию, которая была развернута со 100% трафиком. Поле `canaryTrafficPercent` требуется указать процент трафика, который должен быть перенаправлен на новую версию.

Затем KServe автоматически в соответствии со значением поля `canaryTrafficPercent` перераспределит трафик между последней "хорошей" версией и версией, которая разворачивается в данный момент.

Когда будет развернута первая версия сервиса логического вывода `InferenceService`, она получить 100% трафика. Когда разворачивается несколько версий (последняя развернутая версия модели и последняя готовая к развертыванию версия модели), стратегия канареечного развертывания направляет 10% (в рассматриваемом примере) на новую версию (последняя готовая к развертыванию версия модели) и 90% трафика на `LatestRolledoutRevision`. Если новая версия модели по каким-то причинам работает некорректно, то на нее трафик перенаправляться не будет. На последнем шаге стратегия развертывания меняет статус модели (promotes) с `LatestReadyRevision` на статус `LatestRolledoutRevision` и теперь `LatestRolledoutRevision` получает 100% трафика. Если вдруг потребуется выполнить откат версии, то 100% трафика будет перенаправлено на предыдущую "здоровую" / рабочую версию модели `PreviousRolledoutRevision`.
![[canary_1_2 1.png]]
![[canary_3 1.png]]